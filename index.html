<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Editor</title>
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>

    <h1>eBay Description Editor</h1>

    <div class="ede-product-text-section">
    <div class="ede-product-text-container">
        <textarea class="ede-product-title" id="product-title" placeholder="Product Name"></textarea>
        <textarea class="ede-product-text" id="product-text" placeholder="Product Description"></textarea>
    </div>
    </div>
    <div class="ede-btn-container">
        <button id="add-product">+</button>
        <button id="remove-product">-</button>
    </div>

    <div class="ede-dnd-container">
        <div class="ede-img-container">
            <div class="ede-drop-target" id="dropTarget">Drop Image Here</div>
            <input type="text" id="img-url-1" placeholder="Image URL" hidden>
            <input type="text" id="img-description-1" placeholder="Product Name">
            <input type="text" id="img-link-1" placeholder="Product Link">
            <button id="clear-img">CLEAR</button>
        </div>

        <div class="ede-img-container">
            <div class="ede-drop-target" id="dropTarget">Drop Image Here</div>
            <input type="text" id="img-url-2" placeholder="Image URL" hidden>
            <input type="text" id="img-description-2" placeholder="Product Name">
            <input type="text" id="img-link-2" placeholder="Product Link">
            <button id="clear-img">CLEAR</button>
        </div>

        <div class="ede-img-container">
            <div class="ede-drop-target" id="dropTarget">Drop Image Here</div>
            <input type="text" id="img-url-3" placeholder="Image URL" hidden>
            <input type="text" id="img-description-3" placeholder="Product Name">
            <input type="text" id="img-link-3" placeholder="Product Link">
            <button id="clear-img">CLEAR</button>
        </div>

        <div class="ede-img-container">
            <div class="ede-drop-target" id="dropTarget">Drop Image Here</div>
            <input type="text" id="img-url-4" placeholder="Image URL" hidden>
            <input type="text" id="img-description-4" placeholder="Product Name">
            <input type="text" id="img-link-4" placeholder="Product Link">
            <button id="clear-img">CLEAR</button>
        </div>
    </div>

    <div class="ede-btn-container">
        <button id="save-btn" onclick="saveChanges()">Save & Copy</button>
    </div>

    <div class="preview-container">
        <h2>Preview</h2>
        <div id="preview-box">
            <!-- Dynamically injected preview content -->
        </div>
    </div>

    <!-- Add/remove Product Description Section -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const section = document.querySelector(".ede-product-text-section");
            const addButton = document.getElementById("add-product");
            const removeButton = document.getElementById("remove-product");
        
            // Function to add new product text fields
            addButton.addEventListener("click", function () {
                const newProductTextContainer = document.createElement("div");
                newProductTextContainer.classList.add("ede-product-text-container");
        
                const titleTextarea = document.createElement("textarea");
                titleTextarea.classList.add("ede-product-title");
                titleTextarea.placeholder = "Product Name";
        
                const descriptionTextarea = document.createElement("textarea");
                descriptionTextarea.classList.add("ede-product-text");
                descriptionTextarea.placeholder = "Product Description";
        
                newProductTextContainer.appendChild(titleTextarea);
                newProductTextContainer.appendChild(descriptionTextarea);
                section.appendChild(newProductTextContainer);
            });
        
            // Function to remove the last product text fields
            removeButton.addEventListener("click", function () {
                const containers = section.querySelectorAll(".ede-product-text-container");
                if (containers.length > 1) {
                    containers[containers.length - 1].remove();
                }
            });
        })
    </script>

    <!-- Image Drag and Drop -->
    <script>
        const dropTargets = document.querySelectorAll(".ede-drop-target");
        const clearButtons = document.querySelectorAll("#clear-img");
        
        dropTargets.forEach((dropTarget) => {
            dropTarget.addEventListener("dragover", function (e) {
                e.preventDefault();
                dropTarget.style.backgroundColor = "#ddd";
            });
        
            dropTarget.addEventListener("dragleave", function () {
                dropTarget.style.backgroundColor = "";
            });
        
            dropTarget.addEventListener("drop", function (e) {
                e.preventDefault();
                dropTarget.style.backgroundColor = "";
        
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith("image/")) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const imgURL = event.target.result;
        
                        // Create an image preview inside the drop target
                        dropTarget.innerHTML = `<img src="${imgURL}" alt="Dropped Image" style="max-width: 100%; height: 100%; object-fit: cover;">`;
        
                        // Store the image URL in the hidden input field
                        const imgURLInput = dropTarget.parentElement.querySelector("input[placeholder='Image URL']");
                        imgURLInput.value = imgURL;
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert("Please drop a valid image file.");
                }
            });
        });
        
        clearButtons.forEach((clearButton) => {
            clearButton.addEventListener("click", function () {
                const imgContainer = clearButton.parentElement;
                const dropTarget = imgContainer.querySelector(".ede-drop-target");
                const imgURLInput = imgContainer.querySelector("input[placeholder='Image URL']");
        
                dropTarget.innerHTML = "Drop Image Here";
                imgURLInput.value = "";
            });
        });
    </script>


<script>
    function previewHTML(updatedHTML) {
    const previewContainer = document.getElementById("preview-box");
    previewContainer.innerHTML = ""; // Clear previous preview

    const iframe = document.createElement("iframe");
    iframe.style.width = "100%";
    iframe.style.height = "600px";
    iframe.style.border = "1px solid #ddd";

    previewContainer.appendChild(iframe);

    iframe.contentDocument.open();
    iframe.contentDocument.write(updatedHTML);
    iframe.contentDocument.close();
}

document.getElementById("preview-btn").addEventListener("click", function () {
    fetch("source.html")
        .then(response => response.text())
        .then(sourceHTML => previewHTML(sourceHTML))
        .catch(error => console.error("Error fetching source.html:", error));
});


    function saveChanges() {
        fetch("source.html")
        .then(response => response.text())
        .then(sourceHTML => {
            // Convert source.html into a DOM element
            const parser = new DOMParser();
            const doc = parser.parseFromString(sourceHTML, "text/html");

            //Handle Multiple Product Titles and Descriptions
            const productContainers = document.querySelectorAll(".ede-product-text-container");
            let productHTML = "";

            productContainers.forEach((container) => {
                const title = container.querySelector(".ede-product-title")?.value.trim() || "";
                const description = container.querySelector(".ede-product-text")?.value.trim() || "";

                if (title || description) {
                    productHTML += `<div class="product-item">`; // Wrapper for each product
                    
                    if (title) {
                        productHTML += `<p class="product-title">${title}</p>`; // Keep title first
                    }

                    if (description) {
                        const sentences = description.split("\n").filter(sentence => sentence.trim() !== "");
                        productHTML += `<ul class="product-description">`;
                        sentences.forEach(sentence => {
                            productHTML += `<li>${sentence.trim()}</li>`; // Wrap each line in <li>
                        });
                        productHTML += `</ul>`;
                    }

                    productHTML += `</div>`; // End product wrapper
                }
            });

            // Insert into source.html
            const descContainer = doc.querySelector(".product-description-container");
            if (descContainer) descContainer.innerHTML = productHTML;

            
            // Update Image Data
            const images = [];
            for (let i = 1; i <= 4; i++) {
                const imgUrl = document.getElementById(`img-url-${i}`).value;
                const imgDesc = document.getElementById(`img-description-${i}`).value;
                const imgLink = document.getElementById(`img-link-${i}`).value;

                if (imgUrl && imgDesc && imgLink) {
                    images.push({ url: imgUrl, desc: imgDesc, link: imgLink });
                }
            }

            const addonContainer = doc.querySelector("#source-addons");
            if (addonContainer) {
                addonContainer.innerHTML = ""; // Clear existing add-ons

                images.forEach((image) => {
                    const newImageHTML = `
                    <div class="img-container">
                        <a href="${image.link}">
                            <img alt="${image.desc}" src="${image.url}">
                        </a>
                        <p class="img-description">${image.desc}</p>
                    </div>`;
                    addonContainer.innerHTML += newImageHTML;
                });
            }

        // Final Stage
            const updatedHTML = doc.documentElement.outerHTML;

            previewHTML(updatedHTML); 

        // Copy the updated HTML to clipboard
            const tempTextarea = document.createElement("textarea");
            tempTextarea.value = updatedHTML;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            document.execCommand("copy");
            document.body.removeChild(tempTextarea);

            alert("Copied to clipboard!");
        })
        .catch(error => {
            console.error("Error fetching source.html:", error);
            alert("Failed to fetch source.html.");
        });

    }
    </script>
    
    
</body>
</html>
